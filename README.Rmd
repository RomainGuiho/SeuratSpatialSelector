---
output: github_document
knitr:
  opts_chunk: 
    eval: false
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# SeuratSpatialSelector

<!-- badges: start -->

<!-- badges: end -->

SeuratSpatialSelector provides an intuitive way to manually select cells from spatial transcriptomic data within a Seurat object. Using an interactive Plotly interface, users can draw freehand regions of interest (ROIs) directly on the spatial plots and store the selected cells in a new metadata column — making downstream analyses (such as subset visualization, differential expression, or spatial pattern analysis) much easier.

The package supports multiple ways to define spatial regions depending on how the Seurat object was built and which spatial technology was used.

## Installation

You can install the development version of SeuratSpatialSelector like so:

``` r
devtools::install_github("RomainGuiho/SeuratSpatialSelector")
```

## Core function

```         
run_spatial_selection()
```

-   Opens an interactive selection interface for each field of view (FOV) or metadata-defined region.

-   Adds (or updates) a metadata column (default: `ManualSelection`) in the Seurat object.

-   Can work incrementally (adding multiple labels without resetting previous ones).

-   Supports options for point size and coordinate inversion.

## Usage Examples

### 1. Selection from Seurat FOVs (e.g. Xenium data)

```         
merge_xenium <- readRDS("Save/merge_xenium.rds")
fovs <- names(merge_xenium@images)

merge_xenium <- run_spatial_selection(
  seurat_obj   = merge_xenium,
  fovs         = fovs,
  metadata_col = "ManualSelection",
  positive_label = "Selected",
  negative_label = "Not_Selected",
  point_size   = 2
)

ImageDimPlot(
  merge_xenium,
  group.by = "ManualSelection",
  boundaries = "centroids",
  fov = "Xenium_001",
  size = 1
)
```

### 2. Selection based on a metadata field (e.g. CosMx data)

```         
merge_cosmx <- readRDS("Save/merge_cosmx.rds")

# Example: define a metadata column for smaller sub-FOVs
merge_cosmx@meta.data[["slide_fov"]] <- c(
  gsub("_[^_]+_", "_", merge_cosmx@images[["slide_1"]]@boundaries[["centroids"]]@cells),
  gsub("_[^_]+_", "_", merge_cosmx@images[["slide_2"]]@boundaries[["centroids"]]@cells)
)

list_slide_fov <- c("1_23", "1_42", "2_12", "2_31")
list_image <- c("slide_1", "slide_1", "slide_2", "slide_2")

merge_cosmx <- run_spatial_selection(
  seurat_obj   = merge_cosmx,
  meta_id      = "slide_fov",
  fovs         = list_slide_fov,
  images       = list_image,
  metadata_col = "ManualSelection",
  positive_label = "Selected",
  negative_label = "Not_Selected"
)
```

## Incremental labeling

When you want to define multiple regions with different labels (e.g., “Selected_label_1”, “Selected_label_2”),
use the `incremental = TRUE` option to prevent resetting the metadata.

```         
merge_cosmx <- run_spatial_selection(
  seurat_obj   = merge_cosmx,
  meta_id      = "slide_fov",
  fovs         = list_slide_fov,
  images       = list_image,
  metadata_col = "ManualSelection",
  positive_label = "Selected_label_1",
  negative_label = "Not_Selected"
)

merge_cosmx <- run_spatial_selection(
  seurat_obj   = merge_cosmx,
  meta_id      = "slide_fov",
  fovs         = list_slide_fov,
  images       = list_image,
  metadata_col = "ManualSelection",
  positive_label = "Selected_label_2",
  incremental   = TRUE
)
```

## Advanced Usage

-   Hold Shift to select multiple regions on the same FOV.

-   Adjust point_size to improve visibility for dense plots.

-   Set invert_coordinates = TRUE if the plotted coordinates appear flipped.

-   Combine incremental labels for multi-region annotation.
